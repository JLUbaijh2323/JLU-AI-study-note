
Tags: #Linux #SystemEngineering #DevOps #Shell #Interview #EmbodiedAI

Status: 🟡 In Progress -> 🟢 Mastered

Target: 能够编写自动化脚本 (Pipeline)，管理 GPU 集群，调试复杂环境。

---

## 🧐 第一章：Linux 的世界观（面试必问的心法）

在 Windows 里，你点击图标打开软件。但在 Linux（尤其是服务器版）里，一切都是**文本流**。

> [!ABSTRACT] 核心哲学：一切皆文件 (Everything is a file)
> 
> - 你的文档是文件。
>     
> - 你的硬盘 (`/dev/sda`) 是文件。
>     
> - 你插在机器人上的激光雷达 (`/dev/ttyUSB0`) 也是文件。
>     
> - 运行中的程序（进程）在 Linux 眼里也是 `/proc/` 下的一个个文件夹。
>     
> 
> **面试含义：** 这意味着你可以用同一套命令（读、写、移动、删除）来操作文档、硬件设备和系统内核。这就是为什么 Linux 适合做“具身智能”和“底层系统”开发。

---

## ⛓️ 第二章：Pipeline（管道）与流操作 —— Linux 的灵魂

_JD 关键词：数据采集、传感器数据处理 Pipeline、工具链研发_

你问到了 Pipeline，这是 Linux 最强大的功能。

符号是竖线：| （在键盘回车键上方）。

### 2.1 什么是 Pipeline？

想象一条流水线。

- **命令A** 就像“收割机”，负责把麦子（数据）收上来。
    
- **管道 `|`** 就像传送带，把命令A产生的结果，直接扔给命令B。
    
- **命令B** 就像“脱粒机”，处理这一批麦子。
    

**不使用 Pipeline：**

1. 运行命令A，结果保存到临时文件 `temp.txt`。
    
2. 打开 `temp.txt` 复制内容。
    
3. 粘贴给命令B处理。
    
    (太慢了，而且如果有100GB数据，硬盘就爆了)
    

使用 Pipeline：

命令A | 命令B | 命令C

数据像水流一样，流过每一个处理环节，最终输出结果。

### 2.2 实战：日志分析 Pipeline

**场景：** 昨天晚上的大模型训练挂了，Log文件 `training.log` 有 500MB 大，全是字。你想知道一共报错了多少次。

1. **`cat training.log`**: (Input) 读取整个文件内容。
    
2. **`grep "Error"`**: (Filter) 这是一个过滤器。它只保留包含 "Error" 字样的行，其他全部丢掉。
    
3. **`wc -l`**: (Counter) `wc` 是 Word Count，`-l` 是统计行数。
    

**组合拳（这就是 Pipeline）：**

Bash

```
cat training.log | grep "Error" | wc -l
```

解释： 把文件内容丢进管道 -> 筛选出含Error的行 -> 数一数还剩多少行。

结果： 屏幕上只显示一个数字，比如 42。

### 2.3 实战：查找占用显存最多的进程

**场景：** 服务器显存满了，你想揪出是谁在跑大模型。

Bash

```
ps -ef | grep python | grep -v grep
```

- `ps -ef`: 列出系统当前所有进程（几千行，眼花缭乱）。
    
- `grep python`: 只要含 "python" 关键字的进程（因为深度学习基本都用 python）。
    
- `grep -v grep`: （进阶细节）把自己这条 grep 命令过滤掉（exclude），只看真正的程序。
    

---

## 📥 第三章：IO 重定向 —— 掌控数据的去向

_JD 关键词：自动化仿真训练、持续优化_

默认情况下，命令的结果会打印在屏幕上（标准输出 stdout）。

如果你在跑一个需要 3 天的训练任务，你不能一直盯着屏幕，你需要把结果存起来。

### 3.1 三个重要符号

1. **`>` (覆盖写入)**: 把结果写入文件。如果文件存在，**清空重写**。
    
    - `echo "Start Training" > log.txt` -> 文件里只有一行 "Start Training"。
        
2. **`>>` (追加写入)**: 把结果写到文件末尾。**保留原内容**。
    
    - `echo "Epoch 1 Finished" >> log.txt` -> 文件里现在有两行了。
        
3. **`2>` (错误输出)**: 这是一个特殊通道。只有程序**报错**的信息，才会走这个通道。
    

### 3.2 面试级连招：完美后台运行

**面试题：** 如何在服务器上启动一个训练任务，要求：

1. 即便我关掉 SSH 连接（合上电脑），任务也不能停。
    
2. 正常的打印信息存到 `output.log`。
    
3. 报错信息（如 CUDA OOM）存到 `error.log`。
    
4. 在后台默默跑。
    

**答案：**

Bash

```
nohup python train.py > output.log 2> error.log &
```

- **`nohup`**: (No Hang Up) 忽略挂断信号，哪怕你断网了，程序继续跑。
    
- **`>`**: 标准输出去向。
    
- **`2>`**: 错误输出去向。
    
- **`&`**: 放到后台运行（Background），立刻把终端控制权还给你。
    

---

## 🛡️ 第四章：权限管理 —— 为什么我跑不起来？

_JD 关键词：嵌入式系统开发、部署、Docker_

在 Windows 里你通常是管理员。在 Linux 公司服务器上，你只是个普通用户 `user`。

### 4.1 `ls -l` 的天书解码

输入 ls -l myscript.sh，你会看到类似：

-rw-r--r-- 1 user group 1024 Jan 1 10:00 myscript.sh

重点看最前面的 -rw-r--r--：

把它拆成 4 部分看： - | rw- | r-- | r--

1. **`-`**: 代表这是个普通文件（如果是 `d` 代表是文件夹）。
    
2. **`rw-` (Owner)**: 拥有者（你）的权限。**R**ead(读)✅，**W**rite(写)✅，E**x**ecute(执行)❌。
    
3. **`r--` (Group)**: 同组人（同事）的权限。只读。
    
4. **`r--` (Others)**: 其他人（比如游客）的权限。只读。
    

### 4.2 关键命令：`chmod`

场景： 你写了一个脚本 run.sh 用来启动机器人，但是输入 ./run.sh 提示 Permission denied。

原因： 上面可以看到，Owner 只有 rw，没有 x (执行权)。

**小白解法：**

Bash

```
chmod +x run.sh
```

_(给所有人加上 e**x**ecute 权限。最常用！)_

**老鸟解法（面试装逼用）：**

Bash

```
chmod 755 run.sh
```

- 4=Read, 2=Write, 1=Execute。
    
- 7 = 4+2+1 (Owner: 读+写+执行)
    
- 5 = 4+0+1 (Group: 读+执行，防手贱修改)
    
- 5 = 4+0+1 (Others: 读+执行)
    

---

## 🔧 第五章：Shell 脚本编程 —— 所谓“工具链”的雏形

_JD 关键词：研发系统工具链、全生命周期_

JD 里说要研发“工具链”，其实很多时候就是把一堆繁琐的命令封装成一个脚本。

### 5.1 你的第一个自动化脚本

假设你要做这件事：

1. 创建一个新的日期文件夹。
    
2. 检查 GPU 是否空闲。
    
3. 如果空闲，开始训练。
    

创建一个文件 `auto_train.sh`，内容如下（小白注释版）：

Bash

```
#!/bin/bash
# ↑ 第一行必须写这个，告诉系统用 bash 解释器来执行

# 1. 定义变量 (注意等号两边不能有空格)
DATE=$(date +%Y%m%d)
DATA_DIR="./data"

# 2. 打印信息
echo "正在准备任务，日期: $DATE"

# 3. 流程控制：判断数据文件夹是否存在
if [ -d "$DATA_DIR" ]; then
    echo "数据目录存在，准备开始..."
    
    # 创建今天的日志文件夹
    mkdir -p logs/$DATE
    
    # 启动训练 (假装在跑)
    echo "Training started..."
    # python train.py --log_dir logs/$DATE  <-- 真正工作时取消注释
else
    echo "错误：找不到数据目录！"
    exit 1  # 返回错误代码
fi
```

**怎么用？**

1. `chmod +x auto_train.sh`
    
2. `./auto_train.sh`
    

**面试价值：** 面试官问你“如果每天都要跑同样的测试，你怎么做？” 你回答：“我会写一个 Shell 脚本，通过 CronJob（定时任务）或者 CI/CD 触发，脚本里包含环境检查、执行和日志归档逻辑。” —— **完美。**

---

## 🌐 第六章：环境变量 —— 很多人挂在这里

_JD 关键词：C++/Python/CUDA开发生态_

**场景：** 你装了 PyTorch，输入 `python` 进去 import torch 成功。但是输入 `nvcc -V` 查不到 CUDA 版本，或者编译 C++ 代码报错找不到库。

### 6.1 什么是环境变量？

Linux 系统就像一个巨大的图书馆。

- **`PATH`**: 是一张“书目检索卡”。
    
    - 当你输入 `python` 时，系统会去 `PATH` 里记录的每一个文件夹里找，看哪个文件夹里有个叫 python 的程序。
        
- **`LD_LIBRARY_PATH`**: 是 C++ 程序的“依赖库检索卡”。
    
    - 当你的 AI 模型跑起来时，它需要加载 `libcuda.so`。它会去这个变量记录的路径里找。
        

### 6.2 怎么修改？(永久生效)

你需要编辑用户配置文件 `~/.bashrc`。

1. `nano ~/.bashrc` (打开配置文件)
    
2. 移动到最后一行，添加：
    
    Bash
    
    ```
    export PATH=/usr/local/cuda/bin:$PATH
    export LD_LIBRARY_PATH=/usr/local/cuda/lib64:$LD_LIBRARY_PATH
    ```
    
    _解析：把 CUDA 的 bin 目录，加到原有的 PATH 列表前面。_
    
3. `source ~/.bashrc` (**关键步骤**：让修改立刻生效，不用重启电脑)。
    

---

## ⚔️ 第七章：系统级面试题模拟 (Q&A)

**Q1: 服务器很卡，你怎么排查？**

> 小白回答： 重启。
> 
> 系统工程师回答：
> 
> 1. 先用 `htop` 看 **Load Average**（平均负载）和 **CPU使用率**。如果 Load 很高但 CPU 很低，说明是 **IO阻塞**（硬盘读写太慢了）。
>     
> 2. 用 `free -h` 看内存是不是满了，有没有用到 Swap（虚拟内存）。
>     
> 3. 用 `nvidia-smi` 看是不是有人占着显卡不跑任务。
>     
> 4. 用 `iotop` 抓出是谁在疯狂读写硬盘。
>     

**Q2: `rm -rf` 删了重要数据怎么办？**

> **回答：**
> 
> 1. **立刻停止一切写入操作！** 卸载挂载盘 (`umount`)。
>     
> 2. Linux 删除文件本质是把索引删了，数据还在磁盘块上。
>     
> 3. 使用 `extundelete` 等工具尝试恢复（但在生产环境，更重要的是强调 **备份机制** 和 **权限控制**，比如禁止在脚本里使用未检查变量的 `rm -rf $VAR/*`，万一 `$VAR` 是空的，就变成了 `rm -rf /*`，系统直接去世）。
>     

**Q3: 什么是软链接 (Soft Link)？和复制有什么区别？**

> 回答：
> 
> ln -s 源文件 目标快捷方式。
> 
> 区别在于：复制 (cp) 会占用双倍磁盘空间，修改副本不影响原件。软链接 只是一个指向原文件的“指针/快捷方式”，不占空间，修改内容会直接改动原文件。
> 
> 场景： 训练数据集太大（1TB），放在 /data 盘，但代码默认读 /home/code/data。不用改代码，直接做一个软链过去。

---

## 🎓 总结：学习路线图

1. **基础操作 (3天)**: `ls`, `cd`, `mkdir`, `cp`, `mv`, `rm`, `cat`, `less`, `nano/vim`.
    
2. **流与管道 (2天)**: `|`, `grep`, `>`, `>>`, `2>&1`. (这部分最能体现你是否入门)。
    
3. **权限与进程 (2天)**: `chmod`, `ps`, `kill`, `htop`, `nvidia-smi`.
    
4. **实战环境配置 (持续)**: 尝试在 Linux 下安装 Anaconda, PyTorch, 配置 `.bashrc`。
    

把这份笔记里的命令全部在虚拟机或 WSL (Windows Subsystem for Linux) 里敲一遍，遇到报错去 Google，你就能达到面试水平。加油！